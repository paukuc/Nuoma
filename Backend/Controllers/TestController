using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using DemoEntities;
using Entity;

[ApiController]
[Route("[controller]")]
public class TestController : ControllerBase
{
    private readonly ApplicationDbContext _context;

    public TestController(ApplicationDbContext context)
    {
        _context = context;
    }

    [HttpGet("testdbconnection")]
    public IActionResult TestDbConnection()
    {
        string connectionString = _context.Database.GetDbConnection().ConnectionString;
        try
        {
            _context.Database.OpenConnection();
            _context.Database.CloseConnection();
            return Ok("Database connection successful!");
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"{connectionString} Database connection error: {ex.Message}");
        }
    }

    	/// <summary>
	/// List entities.
	/// </summary>
	/// <returns>A list of entities.</returns>
	/// <response code="500">On exception.</response>
	[HttpGet("list")]
	[ProducesResponseType(typeof(List<EntityForL>), StatusCodes.Status200OK)]
	[ProducesResponseType(StatusCodes.Status500InternalServerError)]
	public IActionResult List()
	{
		//load entities from DB, convert into listing views
		var ents = _context.demoEntities.ToList();
		return Ok(ents);
	}
}
